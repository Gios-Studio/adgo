(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{20564:(e,s,l)=>{"use strict";l.d(s,{A:()=>c});var t=l(37876),a=l(48230),r=l.n(a),n=l(89099);let i=[{href:"/dashboard",label:"Dashboard"},{href:"/adupload",label:"Ad Upload"},{href:"/analytics",label:"Analytics"},{href:"/wallet",label:"Wallet"},{href:"/settings",label:"Settings"}];function c(e){let{children:s}=e,l=(0,n.useRouter)();return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("nav",{className:"bg-white shadow-md border-b border-gray-200",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsx)("div",{className:"flex justify-between h-16",children:(0,t.jsx)("div",{className:"flex space-x-8",children:i.map(e=>{let s=l.pathname===e.href;return(0,t.jsx)(r(),{href:e.href,className:"\n                      inline-flex items-center px-1 pt-1 text-sm font-medium transition-all duration-200 ease-in-out\n                      border-b-2 hover:border-green-500 focus:outline-none focus:border-green-500\n                      ".concat(s?"border-green-600 text-green-700":"border-transparent text-gray-700 hover:text-green-600 hover:underline","\n                    "),children:e.label},e.href)})})})})}),(0,t.jsx)("main",{className:"p-8",children:s})]})}},67580:(e,s,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return l(80110)}])},80110:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>i});var t=l(37876),a=l(20564),r=l(14232),n=l(4613);function i(){let{data:e,loading:s,error:l}=(()=>{let[e,s]=(0,r.useState)({impressions:0,clicks:0,ctr:0,roi:0,spend:0,earnings:0}),[l,t]=(0,r.useState)(!0),[a,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=async()=>{try{let{data:e,error:l}=await n.N.from("analytics_events").select("event_type, campaign_id");if(l)throw l;let{data:t,error:a}=await n.N.from("wallets").select("balance_cents");if(a)throw a;let r=(null==e?void 0:e.filter(e=>"impression"===e.event_type).length)||0,i=(null==e?void 0:e.filter(e=>"click"===e.event_type).length)||0,c=(null==t?void 0:t.reduce((e,s)=>e+(s.balance_cents||0),0))||0,o=r>0?i/r*100:0;s({impressions:r,clicks:i,ctr:o,roi:1.5*o,spend:.5*r,earnings:c/100})}catch(e){console.error("KPI Fetch Error:",e),i(e)}finally{t(!1)}};e();let l=n.N.channel("kpi-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"analytics_events"},s=>{console.log("\uD83D\uDCCA New analytics event:",s.new),e()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"wallets"},s=>{console.log("\uD83D\uDCB0 Wallet updated:",s.new),e()}).subscribe();return()=>{console.log("\uD83E\uDDF9 Cleaning up KPI subscriptions"),n.N.removeChannel(l)}},[]),{data:e,loading:l,error:a}})();return s?(0,t.jsx)(a.A,{children:(0,t.jsx)("p",{children:"Loading metrics..."})}):l?(0,t.jsx)(a.A,{children:(0,t.jsxs)("p",{className:"text-red-500",children:["Error loading metrics: ",l.message]})}):(0,t.jsxs)(a.A,{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Dashboard Metrics"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,t.jsx)(c,{label:"Impressions",value:e.impressions,icon:"\uD83D\uDC41️"}),(0,t.jsx)(c,{label:"Clicks",value:e.clicks,icon:"\uD83D\uDDB1️"}),(0,t.jsx)(c,{label:"CTR (%)",value:e.ctr.toFixed(2),icon:"\uD83D\uDCC8"}),(0,t.jsx)(c,{label:"ROI",value:e.roi.toFixed(2),icon:"\uD83D\uDCB9"}),(0,t.jsx)(c,{label:"Spend (KES)",value:e.spend.toFixed(2),icon:"\uD83D\uDCB8"}),(0,t.jsx)(c,{label:"Earnings (KES)",value:e.earnings.toFixed(2),icon:"\uD83D\uDCB0"})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center text-sm text-green-600",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"}),"Live metrics - updates automatically"]})]})}let c=e=>{let{label:s,value:l,icon:a}=e;return(0,t.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow text-center hover:shadow-md transition-shadow",children:[a&&(0,t.jsx)("div",{className:"text-2xl mb-2",children:a}),(0,t.jsx)("h2",{className:"text-sm text-gray-500",children:s}),(0,t.jsx)("p",{className:"text-xl font-semibold text-gray-800",children:l})]})}}},e=>{e.O(0,[8,636,593,792],()=>e(e.s=67580)),_N_E=e.O()}]);